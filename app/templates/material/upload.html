{% extends "base.html" %}

{% block title %}Загрузка материала{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Загрузка материала</h2>
                </div>
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data">
                        {{ form.csrf_token }}
                        
                        <div class="mb-3">
                            {{ form.title.label(class="form-label") }}
                            {{ form.title(class="form-control") }}
                            {% if form.title.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.title.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            {{ form.description.label(class="form-label") }}
                            {{ form.description(class="form-control", rows=4) }}
                            {% if form.description.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.description.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            {{ form.material_type.label(class="form-label") }}
                            <div class="btn-group" role="group">
                                {% for value, label in form.material_type.choices %}
                                    <input type="radio" 
                                           class="btn-check" 
                                           name="{{ form.material_type.name }}" 
                                           id="{{ form.material_type.name }}_{{ loop.index0 }}" 
                                           value="{{ value }}"
                                           {% if form.material_type.data == value %}checked{% endif %}>
                                    <label class="btn btn-outline-primary" 
                                           for="{{ form.material_type.name }}_{{ loop.index0 }}">
                                        {{ label }}
                                    </label>
                                {% endfor %}
                            </div>
                            {% if form.material_type.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.material_type.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                {{ form.create_new_category(class="form-check-input") }}
                                {{ form.create_new_category.label(class="form-check-label") }}
                            </div>
                        </div>
                        
                        <div class="mb-3" id="existing-category">
                            {{ form.category_id.label(class="form-label") }}
                            {{ form.category_id(class="form-select") }}
                            {% if form.category_id.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.category_id.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3" id="new-category" style="display: none;">
                            {{ form.new_category.label(class="form-label") }}
                            {{ form.new_category(class="form-control") }}
                            {% if form.new_category.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.new_category.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <!-- Поле для файла -->
                        <div class="mb-3 file-field" style="display: none;">
                            {{ form.file.label(class="form-label") }}
                            {{ form.file(class="form-control") }}
                            <div class="form-text">Допустимые форматы: PDF, DOC, DOCX, TXT, PPT, PPTX</div>
                            {% if form.file.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.file.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <!-- Поле для видео URL -->
                        <div class="mb-3 video-field" style="display: none;">
                            {{ form.video_url.label(class="form-label") }}
                            {{ form.video_url(class="form-control", placeholder="https://www.youtube.com/watch?v=...") }}
                            <div class="form-text">Поддерживаются YouTube, Rutube, VK и другие видеохостинги</div>
                            {% if form.video_url.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.video_url.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">Загрузить</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const materialType = document.querySelectorAll('input[name="material_type"]');
    const fileField = document.querySelector('.file-field');
    const videoField = document.querySelector('.video-field');
    const existingCategory = document.getElementById('existing-category');
    const newCategory = document.getElementById('new-category');
    const createNewCategory = document.getElementById('create_new_category');
    
    function toggleFields() {
        const selectedType = document.querySelector('input[name="material_type"]:checked').value;
        fileField.style.display = selectedType === 'file' ? 'block' : 'none';
        videoField.style.display = selectedType === 'video' ? 'block' : 'none';
    }
    
    materialType.forEach(radio => {
        radio.addEventListener('change', toggleFields);
    });
    
    // Обработка переключения создания новой категории
    createNewCategory.addEventListener('change', function() {
        if (this.checked) {
            existingCategory.style.display = 'none';
            newCategory.style.display = 'block';
        } else {
            existingCategory.style.display = 'block';
            newCategory.style.display = 'none';
        }
    });
    
    // Инициализация при загрузке страницы
    toggleFields();

    if (createNewCategory.checked) {
        existingCategory.style.display = 'none';
        newCategory.style.display = 'block';
    }
});
</script>
{% endblock %} 